
이 명령어는 '스텔스'를 완전히 포기하고 오직 '속도'에만 집중하여 열려있는 포트를 신속하게 찾아내기 위한 목적
```bash
nmap -p- -Pn $target -v -T5 --min-rate 1500 --max-rtt-timeout 500ms --max-retries 3 --open -oN nmap_ports.txt
```


핑 스캔 (현재 대역대 ip 스캔)
```bash
nmap -v -sn 10.200.180.0/24 --open
```



Proxychains 사용 시

### ## 💡 Proxychains와 함께 사용하기 어려운 Nmap 옵션

**Proxychains를 이용할 때 기능이 제한되거나 사용할 수 없는 Nmap 옵션들이  존재함**

원인은 **`proxychains`가 작동하는 방식**에 있음. `proxychains`는 애플리케이션이 만드는 **TCP 연결(connect) 요청**을 가로채서 프록시 서버로 보내는 원리임. 따라서 TCP 기반이 아니거나, 일반적인 TCP 연결 방식을 사용하지 않는 스캔 옵션들은 제대로 동작하지 않음.

**❌ 사용이 어렵거나 불가능한 대표적인 옵션:**

- **`nmap -sS` (TCP SYN 스캔 / 스텔스 스캔)**: 가장 많이 부딪히는 문제입니다. 이 스캔은 완전한 TCP 연결(3-way handshake)을 맺지 않고 SYN 패킷만 보내고 응답을 분석합니다. 하지만 `proxychains`는 완전한 TCP 연결을 중계하도록 설계되었기 때문에, 반쪽짜리 연결인 `-sS` 요청을 처리할 수 없습니다.
    
- **`nmap -sU` (UDP 스캔)**: UDP는 TCP와 달리 비연결성 프로토콜입니다. SOCKS5 프록시가 UDP를 지원하기는 하지만, `proxychains`의 구현 방식이나 중간 네트워크 장비 때문에 UDP 스캔은 불안정하거나 실패하는 경우가 많습니다.
    
- **`nmap -sn` (Ping 스캔)**: 직접 경험하신 문제입니다. 이 스캔은 호스트가 활성 상태인지 확인하기 위해 **ICMP(Ping), ARP** 등 다양한 프로토콜을 사용합니다. `proxychains`는 TCP 전용이므로 이러한 Layer 2~3 프로토콜을 터널링할 수 없습니다.
    
- **`nmap -O` (OS 탐지)**: OS 탐지는 비정상적인 패킷을 포함한 다양한 종류의 TCP/UDP/ICMP 패킷을 보내고 그 응답 패턴을 분석합니다. 프록시를 거치면 이런 특수한 패킷들이 왜곡되거나 차단되어 결과가 부정확하게 나옵니다.
    
- **일부 NSE 스크립트**: 브로드캐스트(`broadcast-*`)나 저수준 네트워크 패킷을 사용하는 스크립트들은 작동하지 않습니다.
    

**✅ Proxychains와 호환성이 좋은 옵션:**

- **`nmap -sT` (TCP Connect 스캔)**: 운영체제의 정상적인 TCP 연결 기능을 그대로 사용하므로 `proxychains`와 완벽하게 호환됩니다. 프록시를 사용할 때의 **표준 스캔 방식**이라고 생각하시면 됩니다.
    
- **`nmap -sV` (버전 탐지)**: `-sT`로 열린 포트를 확인한 후에, 해당 포트로 TCP 연결을 맺고 배너 정보 등을 수집합니다. 정상적인 TCP 통신 기반이므로 잘 동작합니다.
    
- **대부분의 TCP 기반 NSE 스크립트**: `http-title`, `ssl-cert` 등과 같이 일단 연결이 수립된 후 통신하는 스크립트들은 문제없이 사용할 수 있습니다.


**`-sT` (TCP Connect 스캔)**과 **`-Pn` (Ping 스킵)**을 기본으로 진행



### ## 📡 1. 살아있는 호스트 찾기 (Ping 스캔 대용)

`nmap -sn`을 사용할 수 없으므로, 내부망에서 흔히 열려있는 주요 포트들을 스캔하여 응답하는 호스트를 찾아내는 방법입니다. 가장 먼저 수행해야 할 기본 정찰 단계입니다.

Bash

```bash
proxychains -q nmap -sT -Pn -p 21,22,80,443,445,3389,5985,8080 --open 172.16.1.0/24
```

- **`-p 21,22,80,...`**: FTP, SSH, HTTP, HTTPS, SMB, RDP, WinRM 등 내부망에서 자주 사용되는 포트 목록을 지정하여 스캔 속도를 높입니다.
    
- **`--open`**: 스캔 결과에서 **열린(open) 포트가 있는 호스트만 출력**해 줍니다. 결과가 깔끔해져서 살아있는 호스트 목록을 한눈에 파악하기 좋습니다.

### ## 🔎 2. 상세 서비스 및 버전 정보 스캔

1단계에서 찾아낸 살아있는 호스트들을 대상으로, 어떤 서비스들이 어떤 버전으로 실행되고 있는지 상세하게 파악하는 단계입니다.

Bash

```bash
proxychains -q nmap -sT -sV $target -Pn --top-ports 1000
```

- **`-sV`**: 열려있는 포트에서 실행 중인 **서비스의 버전 정보**를 알아냅니다. (예: Apache httpd 2.4.52, OpenSSH 8.2p1) 이는 취약점 검색의 핵심 정보가 됩니다.
    
- **`--top-ports 1000`**: 모든 65535개 포트를 스캔(`-p-`)하는 것은 프록시 환경에서 매우 느립니다. Nmap이 선정한 **사용 빈도가 가장 높은 1000개 포트**를 스캔하여 효율을 극대화합니다.