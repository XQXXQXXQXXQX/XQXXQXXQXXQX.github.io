---
layout: page
title: Kerberos_기법
description: >
  This chapter covers the basics of content creation with Hydejack.
hide_description: true
sitemap: false
---

## 🏢 커버로스(Kerberos)란 무엇인가? (쉽게 이해하기)

커버로스를 **거대한 회사의 보안 시스템**이라고 생각해 보세요. 이 회사(Windows 도메인)의 모든 직원(사용자)과 사무실(서버/서비스)은 중앙 보안실(KDC, 키 분배 센터)을 통해 출입을 관리합니다. 예전 방식(NTLM)처럼 각자 비밀번호만으로 문을 여는 게 아니라, 중앙 보안실에서 **'오늘 사용할 수 있는 특별 출입증(티켓)'**을 발급받아 사용하는 더 안전한 방식입니다.

하지만 이 정교한 시스템에도 해커가 파고들 수 있는 허점들이 존재합니다.

### **핵심 용어 비유**

- **KDC (키 분배 센터)**: 회사의 **중앙 보안실**입니다. 신분 확인(AS)과 출입증 발급(TGS)을 모두 담당합니다.
    
- **TGT (티켓 발급 티켓)**: 중앙 보안실에서 내 신분을 확인하고 발급해 주는 **'만능 출입증'**입니다. 이 자체로는 특정 사무실 문을 열 수 없지만, 이 만능 출입증을 보여주면 특정 사무실 키를 받을 수 있습니다.
    
- **서비스 티켓 (TGS 티켓)**: **'특정 사무실(서버) 전용 키'**입니다. 만능 출입증(TGT)을 보안실에 보여주고 "파일 서버에 들어가고 싶어요"라고 요청하면, 파일 서버만 열 수 있는 티켓을 줍니다.
    
- **SPN (서비스 주체 이름)**: 각 서비스(사무실)에 붙어있는 고유한 이름표입니다. 예를 들어 `HTTP/webserver.corp.local` 처럼 "웹 서버"라는 것을 알려주는 이름입니다. 공격자는 이 이름표를 보고 공격 대상을 찾습니다.
    

---

## 🎟️ 커버로스 인증 절차 (스토리텔링)

사용자가 파일 서버에 접속하는 과정을 이야기로 풀어보겠습니다.

1. **(AS-REQ)** **나(사용자)**: 중앙 보안실(KDC)에 가서 내 사원증(사용자 계정)과 비밀번호를 보여주며 말합니다. "저 본인 맞으니, 오늘 하루 쓸 수 있는 만능 출입증(TGT) 하나 주세요."
    
2. **(AS-REP)** **보안실(KDC)**: 내 신원을 확인하고, 암호화된 만능 출입증(TGT)을 줍니다.
    
3. **(TGS-REQ)** **나**: 이제 파일 서버에 가야 합니다. 다시 보안실로 가서 방금 받은 만능 출입증(TGT)과 함께 말합니다. "이 출입증 주인인데요, '파일 서버'에 들어갈 수 있는 키(서비스 티켓)를 주세요."
    
4. **(TGS-REP)** **보안실(KDC)**: 내 만능 출입증이 유효한지 확인하고, 파일 서버 전용 키(서비스 티켓)를 암호화해서 줍니다.
    
5. **(AP-REQ)** **나**: 드디어 파일 서버 문 앞으로 가서 방금 받은 '파일 서버 전용 키'를 보여줍니다.
    
6. **(AP-REP)** **파일 서버**: 키를 확인하고 문을 열어줍니다. **접속 성공!**
    

---

## 💥 주요 커버로스 공격 기법

이제 당신이 해커가 되어 이 시스템을 어떻게 공격할 수 있는지 알아봅시다. 각 공격에 필요한 최소 권한도 함께 설명합니다.

### **1. 커버로스팅 (Kerberoasting)**

- **필요 권한**: 도메인 내 **아무 사용자 계정**
    
- **공격 원리**:
    
    1. 도메인 내에서 SPN(서비스 이름표)이 등록된 계정들을 찾아냅니다. (예: MSSQL 서비스 계정, 웹 서버 계정 등)
        
    2. 해당 서비스에 접속하고 싶다고 KDC(보안실)에 요청하여 서비스 티켓을 받습니다. **이 티켓은 해당 서비스 계정의 비밀번호 해시로 암호화되어 있습니다.**
        
    3. 이 티켓을 내 컴퓨터로 가져와서, 비밀번호 사전을 이용해 무차별 대입 공격(Offline Brute-force)으로 암호를 풀어냅니다.
        
- **비유**: 보안실에 가서 "SQL 서버 키 주세요"라고 요청하면, 키를 **자물쇠가 걸린 상자(서비스 티켓)**에 담아줍니다. 이 자물쇠는 **SQL 서버 계정의 비밀번호**로 잠겨 있습니다. 이 상자를 통째로 들고 와서 온갖 열쇠(비밀번호)로 열어보는 것과 같습니다. 열리면, 그 서비스 계정의 비밀번호를 알아낸 것입니다.
    

### **2. AS-REP 로스팅 (AS-REP Roasting)**

- **필요 권한**: 도메인 내 **아무 사용자 계정**
    
- **공격 원리**:
    
    1. 일부 사용자 계정은 보안 설정이 잘못되어 '커버로스 사전 인증(Pre-Authentication)' 기능이 꺼져 있습니다.
        
    2. 이런 계정은 KDC(보안실)에 TGT(만능 출입증)를 요청할 때, **사용자 본인임을 먼저 증명하지 않아도** KDC가 암호화된 응답(AS-REP)을 보내줍니다.
        
    3. 이 응답 데이터는 **해당 사용자의 비밀번호 해시로 암호화**되어 있으므로, 이걸 가져와 오프라인에서 비밀번호를 크랙합니다.
        
- **비유**: 보통 보안실에서는 신분증을 먼저 확인하고 출입증을 주지만, 어떤 직원은 "신분증 검사 면제"라는 이상한 혜택을 갖고 있습니다. 그래서 그냥 "저 OOO인데요"라고 말만 하면 보안실이 자물쇠 걸린 상자(AS-REP)를 줍니다. 이 상자를 가져와 비밀번호를 알아내는 것입니다.
    

### **3. 골든 티켓 (Golden Ticket) 👑**

- **필요 권한**: **도메인 관리자(Domain Admin)** 권한 (최종 보스 공격)
    
- **공격 원리**:
    
    1. 도메인의 왕(Domain Admin) 권한을 획득한 후, 도메인 컨트롤러에서 **`krbtgt`라는 특수 계정의 NTLM 해시**를 훔칩니다. 이 계정은 모든 티켓을 서명하고 암호화하는 **마스터 키**입니다.
        
    2. 이 마스터 키를 이용해, **내가 원하는 어떤 사용자(심지어 존재하지 않는 사용자)로든, 어떤 권한(예: 도메인 관리자)을 가진 것처럼 위조된 TGT(만능 출입증)를 만듭니다.**
        
    3. 이 '골든 티켓'을 사용하면 도메인 내의 모든 서버와 서비스에 제약 없이 접근할 수 있습니다.
        
- **비유**: 보안실의 **마스터 키 제작 기계(`krbtgt` 해시) 자체를 훔친 것**입니다. 이제 나는 "회장님" 신분증을 마음대로 찍어내서 회사의 모든 문을 열고 다닐 수 있습니다.
    

### **4. 실버 티켓 (Silver Ticket) 🥈**

- **필요 권한**: **특정 서비스 계정의 비밀번호 해시**
    
- **공격 원리**:
    
    1. 골든 티켓과 비슷하지만, `krbtgt` 마스터 키 대신 **특정 서비스(예: 파일 서버, SQL 서버) 계정의 비밀번호 해시**를 훔칩니다.
        
    2. 이 해시를 이용해 해당 **특정 서비스에만 유효한 가짜 서비스 티켓**을 만듭니다.
        
    3. 이 티켓을 이용하면 KDC를 거치지 않고 바로 해당 서비스에 접근할 수 있습니다.
        
- **비유**: 마스터 키 제작 기계는 못 훔쳤지만, '파일 서버실'의 자물쇠 비밀번호는 알아냈습니다. 이제 파일 서버실 열쇠만 마음대로 복제해서 드나들 수 있게 된 것입니다.
    

### **5. 패스 더 티켓 (Pass the Ticket)**

- **필요 권한**: **사용자 권한**으로 시스템 접근
    
- **공격 원리**:
    
    1. 해커가 침투한 시스템의 메모리(RAM)를 뒤져봅니다.
        
    2. 만약 도메인 관리자 같은 높은 권한의 사용자가 이 시스템에 로그인한 적이 있다면, 그들의 **유효한 커버로스 티켓(TGT나 서비스 티켓)이 메모리에 남아있을 수 있습니다.**
        
    3. 이 티켓을 훔쳐서 내 세션에 주입하면, **비밀번호 없이도 그 사용자의 권한으로 다른 시스템에 접근**할 수 있습니다.
        
- **비유**: 관리자가 자리에 잠시 비운 사이, 책상 위에 놓인 **유효한 출입증(티켓)**을 슬쩍해서 내가 사용하는 것과 같습니다. 비밀번호를 몰라도 출입증만 있으면 문이 열립니다.
    

### **6. 스켈레톤 키 (Skeleton Key)**

- **필요 권한**: **도메인 관리자(Domain Admin)** 권한
    
- **공격 원리**:
    
    1. 도메인 컨트롤러(DC)에 직접 악성코드(Mimikatz 등)를 실행합니다.
        
    2. 이 악성코드는 DC의 인증 프로세스(LSASS) 메모리에 패치를 적용하여, **모든 사용자의 계정에 대해 해커가 지정한 '만능 비밀번호(스켈레톤 키)'**가 작동하도록 만듭니다.
        
    3. 이제 해커는 어떤 사용자 계정이든 자신의 만능 비밀번호로 로그인할 수 있습니다. 원래 사용자의 비밀번호도 그대로 작동하므로 알아차리기 어렵습니다.
        
- **비유**: 건물 전체의 모든 문에 **몰래 '만능 열쇠 구멍'을 추가**하는 것과 같습니다. 원래 열쇠도 작동하지만, 이제 나만의 만능 열쇠로도 모든 문을 열 수 있는 백도어를 만든 것입니다.